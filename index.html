<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>胡智強的個人頁面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        header {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 20px 0;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* footer fixed 會蓋到內容，這裡多留底部空間 */
            padding-bottom: 70px;
        }
        h1 { color: #333; }
        p {
            line-height: 1.6;
            color: #555;
        }
        .social-links { list-style-type: none; padding: 0; }
        .social-links li { display: inline-block; margin-right: 10px; }
        .social-links a { text-decoration: none; color: #4CAF50; font-size: 18px; }
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        .tabs {
            margin: 20px 0;
            text-align: center;
        }
        .tabs button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .tabs button:hover { background-color: #45a049; }
        .tab-content { display: none; }
        .active { display: block; }

        /* ===== 血壓偵測頁：少量補充樣式（不影響其他頁） ===== */
        .bp-card {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            background: #fafafa;
        }
        .bp-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        .bp-kpi {
            font-size: 20px;
            font-weight: bold;
            color: #222;
        }
        .bp-good { color: #0a7a2f; font-weight: bold; }
        .bp-bad { color: #b00020; font-weight: bold; }
        .bp-img, .bp-canvas {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 10px;
        }
        .bp-input {
            padding: 6px 8px;
        }
        .bp-btn {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            background: #4CAF50;
            color: #fff;
        }
        .bp-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .bp-small { color: #666; font-size: 12px; }
    </style>
</head>
<body>

<header>
    <h1>歡迎來到我的個人頁面</h1>
</header>

<div class="container">
    <!-- 按鈕列 -->
    <div class="tabs">
        <button onclick="showTab('intro')">自我介紹</button>
        <button onclick="showTab('monitoring')">遠端監控</button>
        <button onclick="showTab('bloodPressure')">血壓偵測</button>
    </div>

    <!-- 分頁內容：自我介紹 -->
    <div id="intro" class="tab-content active">
        <h2>你好，我是胡智強</h2>
        <p>我是一名學生，來自高雄科技大學電子工程系大四。</p>

        <h3>聯絡方式</h3>
        <p>你可以通過以下方式與我聯繫：</p>
        <ul class="social-links">
            <li><a href="mailto:c111252210@nkust.edu.tw">Email</a></li>
        </ul>
    </div>

    <!-- 分頁內容：遠端監控 -->
    <div id="monitoring" class="tab-content">
        <h2>遠端監控</h2>
        <p>這裡未來會新增遠端監控的相關成果。</p>
    </div>

    <!-- 分頁內容：血壓偵測 -->
    <div id="bloodPressure" class="tab-content">
        <h2>血壓偵測</h2>
        <p class="bp-small">說明：上傳血壓計螢幕照片（建議先裁切到只剩螢幕區域）→ 七段顯示器辨識 → 得到 SYS/DIA → 輸入線性趨勢係數判斷是否脫模。</p>

        <div class="bp-card">
            <div class="bp-row">
                <input id="bpFile" class="bp-input" type="file" accept="image/*">
                <button id="bpRecognizeBtn" class="bp-btn" disabled>辨識</button>
                <span id="bpStatus" class="bp-small">OpenCV.js 載入中…</span>
            </div>
        </div>

        <div class="bp-card">
            <div>預覽：</div>
            <img id="bpPreview" class="bp-img" alt="">
            <canvas id="bpCanvas" class="bp-canvas" style="display:none;"></canvas>
        </div>

        <div class="bp-card">
            <div class="bp-kpi">辨識結果</div>
            <div id="bpResult">尚未辨識</div>
        </div>

        <div class="bp-card">
            <div class="bp-kpi">線性趨勢 + 脫模判斷</div>
            <div class="bp-small">用第 t 次量測（t=0,1,2…）代入：ŷ = a*t + b；若 |y-ŷ| &gt; 閾值 → 脫模。</div>

            <div class="bp-row" style="margin-top:8px;">
                <label>SYS a <input id="bp_a_sys" class="bp-input" type="number" step="0.01" value="0"></label>
                <label>SYS b <input id="bp_b_sys" class="bp-input" type="number" step="0.01" value="120"></label>
            </div>
            <div class="bp-row">
                <label>DIA a <input id="bp_a_dia" class="bp-input" type="number" step="0.01" value="0"></label>
                <label>DIA b <input id="bp_b_dia" class="bp-input" type="number" step="0.01" value="80"></label>
            </div>

            <div class="bp-row">
                <label>脫模閾值(mmHg) <input id="bp_thr" class="bp-input" type="number" value="10"></label>
                <button id="bpJudgeBtn" class="bp-btn" disabled>判斷</button>
            </div>

            <div id="bpJudgeOut" style="margin-top:8px;"></div>
            <div class="bp-small">※ 僅供專題展示參考，不能替代醫療建議</div>
        </div>

        <div class="bp-card">
            <div class="bp-kpi">歷史紀錄（localStorage）</div>
            <div class="bp-row">
                <button id="bpClearBtn" class="bp-btn">清空紀錄</button>
                <span class="bp-small">（只會清你這個瀏覽器的紀錄）</span>
            </div>
            <div id="bpHistory" style="margin-top:8px;"></div>
        </div>
    </div>
</div>

<footer>
    <p>© 2025 胡智強. All Rights Reserved.</p>
</footer>

<script>
    function showTab(tabName) {
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.remove('active'));

        const activeTab = document.getElementById(tabName);
        activeTab.classList.add('active');
    }
</script>

<!-- OpenCV.js：等 wasm 初始化後再啟用按鈕 -->
<script>
  // 1) 先準備好 Module 給 opencv.js 使用
  var Module = {
    onRuntimeInitialized() {
      window.__cvReady = true;
      const s = document.getElementById("bpStatus");
      const btn = document.getElementById("bpRecognizeBtn");
      if (s) s.textContent = "OpenCV.js 已就緒 ✅";
      if (btn) btn.disabled = false;
    }
  };

  // 2) fallback：如果 onRuntimeInitialized 沒觸發，用輪詢確認 cv 是否可用
  (function cvFallback() {
    const timer = setInterval(() => {
      const btn = document.getElementById("bpRecognizeBtn");
      const s = document.getElementById("bpStatus");
      // cv 真的存在才開按鈕
      if (typeof cv !== "undefined" && cv.Mat && btn) {
        window.__cvReady = true;
        btn.disabled = false;
        if (s) s.textContent = "OpenCV.js 已就緒 ✅";
        clearInterval(timer);
      }
    }, 200);
  })();
</script>

<!-- 用 defer，確保按順序載入並執行 -->
<script defer src="https://docs.opencv.org/4.x/opencv.js"></script>


<!-- 血壓辨識主程式：請把我之前給你的 bp.js 放在同層 -->
<script src="./bp.js"></script>

</body>
</html>

