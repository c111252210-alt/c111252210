<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒ¡æ™ºå¼·çš„å€‹äººé é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        header {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 20px 0;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* footer fixed æœƒè“‹åˆ°å…§å®¹ï¼Œé€™è£¡å¤šç•™åº•éƒ¨ç©ºé–“ */
            padding-bottom: 70px;
        }
        h1 { color: #333; }
        p {
            line-height: 1.6;
            color: #555;
        }
        .social-links { list-style-type: none; padding: 0; }
        .social-links li { display: inline-block; margin-right: 10px; }
        .social-links a { text-decoration: none; color: #4CAF50; font-size: 18px; }
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        .tabs {
            margin: 20px 0;
            text-align: center;
        }
        .tabs button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .tabs button:hover { background-color: #45a049; }
        .tab-content { display: none; }
        .active { display: block; }

        /* ===== è¡€å£“åµæ¸¬é ï¼šå°‘é‡è£œå……æ¨£å¼ï¼ˆä¸å½±éŸ¿å…¶ä»–é ï¼‰ ===== */
        .bp-card {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            background: #fafafa;
        }
        .bp-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        .bp-kpi {
            font-size: 20px;
            font-weight: bold;
            color: #222;
        }
        .bp-img {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 10px;
        }
        .bp-input { padding: 6px 8px; }
        .bp-btn {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            background: #4CAF50;
            color: #fff;
        }
        .bp-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .bp-small { color: #666; font-size: 12px; }
    </style>
</head>
<body>

<header>
    <h1>æ­¡è¿ä¾†åˆ°æˆ‘çš„å€‹äººé é¢</h1>
</header>

<div class="container">
    <!-- æŒ‰éˆ•åˆ— -->
    <div class="tabs">
        <button onclick="showTab('intro')">è‡ªæˆ‘ä»‹ç´¹</button>
        <button onclick="showTab('monitoring')">é ç«¯ç›£æ§</button>
        <button onclick="showTab('bloodPressure')">è¡€å£“åµæ¸¬</button>
    </div>

    <!-- åˆ†é å…§å®¹ï¼šè‡ªæˆ‘ä»‹ç´¹ -->
    <div id="intro" class="tab-content active">
        <h2>ä½ å¥½ï¼Œæˆ‘æ˜¯èƒ¡æ™ºå¼·</h2>
        <p>æˆ‘æ˜¯ä¸€åå­¸ç”Ÿï¼Œä¾†è‡ªé«˜é›„ç§‘æŠ€å¤§å­¸é›»å­å·¥ç¨‹ç³»å¤§å››ã€‚</p>

        <h3>è¯çµ¡æ–¹å¼</h3>
        <p>ä½ å¯ä»¥é€šéä»¥ä¸‹æ–¹å¼èˆ‡æˆ‘è¯ç¹«ï¼š</p>
        <ul class="social-links">
            <li><a href="mailto:c111252210@nkust.edu.tw">Email</a></li>
        </ul>
    </div>

    
    <!-- åˆ†é å…§å®¹ï¼šé ç«¯ç›£æ§ -->
    <div id="monitoring" class="tab-content">
        <h2>é ç«¯ç›£æ§</h2>

        <div class="bp-card">
            <div class="bp-kpi">ESP32-CAM ç›´æ’­ä¸²æµ</div>
            <div style="text-align:center">
                <img id="camStream" alt="ESP32-CAM Stream" style="max-width:100%;border-radius:8px;"/>
            </div>
            <div class="bp-small" id="camInfo" style="margin-top:6px;opacity:.7"></div>
        </div>

        <div class="bp-card">
            <div class="bp-row">
                <button class="bp-btn" onclick="doSnapshot()">ğŸ“¸ ä¸‹è¼‰æˆªåœ–</button>
                <button id="ledOn"  class="bp-btn" onclick="toggleLed(true)">ğŸ’¡ LED é–‹</button>
                <button id="ledOff" class="bp-btn" onclick="toggleLed(false)">ğŸ’¡ LED é—œ</button>
            </div>
        </div>
    </div>
<!-- åˆ†é å…§å®¹ï¼šè¡€å£“åµæ¸¬ -->
    <div id="bloodPressure" class="tab-content">
        <h2>è¡€å£“åµæ¸¬</h2>
        <p class="bp-small">
            èªªæ˜ï¼šä¸Šå‚³è¡€å£“è¨ˆç…§ç‰‡ï¼ˆå»ºè­°å…ˆè£åˆ‡åˆ°è¢å¹•ã€é¿å…åå…‰ï¼‰â†’ å‘¼å« Hugging Face Space çš„ PaliGemma API â†’
            å–å¾— SYS / DIA / PUL â†’ å†ç”¨ä½ è¼¸å…¥çš„ç·šæ€§è¶¨å‹¢ä¿‚æ•¸åˆ¤æ–·æ˜¯å¦è„«æ¨¡ã€‚
        </p>

        <div class="bp-card">
            <div class="bp-row">
                <input id="bpFile" class="bp-input" type="file" accept="image/*">
                <button id="bpRecognizeBtn" class="bp-btn" disabled>è¾¨è­˜</button>
                <span id="bpStatus" class="bp-small">è¼‰å…¥ä¸­â€¦</span>
            </div>
        </div>

        <div class="bp-card">
            <div>é è¦½ï¼š</div>
            <img id="bpPreview" class="bp-img" alt="">
        </div>

        <div class="bp-card">
            <div class="bp-kpi">è¾¨è­˜çµæœ</div>
            <div id="bpResult">å°šæœªè¾¨è­˜</div>
        </div>

        <div id="bpTrend" style="margin-top:10px;"></div>
        <button id="bpExportBtn" type="button">åŒ¯å‡º bp_dataï¼ˆJSONï¼‰</button>

            <div class="bp-small">â€» åƒ…ä¾›å°ˆé¡Œå±•ç¤ºåƒè€ƒï¼Œä¸èƒ½æ›¿ä»£é†«ç™‚å»ºè­°</div>
        </div>

        <div class="bp-card">
            <div class="bp-kpi">æ­·å²ç´€éŒ„ï¼ˆlocalStorageï¼‰</div>
            <div class="bp-row">
                <button id="bpClearBtn" class="bp-btn">æ¸…ç©ºç´€éŒ„</button>
                <span class="bp-small">ï¼ˆåªæœƒæ¸…ä½ é€™å€‹ç€è¦½å™¨çš„ç´€éŒ„ï¼‰</span>
                <div id="bpHistory" style="margin-top:8px;"></div>
            </div>
    </div>
</div>

<footer>
    <p>Â© 2025 èƒ¡æ™ºå¼·. All Rights Reserved.</p>
</footer>

<script>
    function showTab(tabName) {
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.remove('active'));

        const activeTab = document.getElementById(tabName);
        activeTab.classList.add('active');
    }
</script>

<!-- è¡€å£“åµæ¸¬ä¸»ç¨‹å¼ -->
<script src="./bp.js?v=20260104"></script>


<script>
// å›ºå®šå…¬é–‹ç¶²å€ï¼ˆå·²é€é Cloudflare Tunnelï¼‰
const CAM_BASE = 'https://cam.111252210.xyz';

document.addEventListener('DOMContentLoaded', () => {
  const img = document.getElementById('camStream');
  if (img) img.src = CAM_BASE + '/stream';
  const info = document.getElementById('camInfo');
  if (info) info.textContent = CAM_BASE + ' /stream';
});

async function doSnapshot(){
  try {
    const r = await fetch(CAM_BASE + '/snapshot', { mode:'cors' });
    if(!r.ok) throw new Error('HTTP ' + r.status);
    const b = await r.blob();
    const url = URL.createObjectURL(b);
    const a = document.createElement('a');
    a.href = url; a.download = 'snapshot.jpg'; a.click();
    URL.revokeObjectURL(url);
  } catch(e){
    alert('æˆªåœ–å¤±æ•—ï¼š' + e.message);
  }
}

async function toggleLed(on){
  try { await fetch(CAM_BASE + '/led?on=' + (on?1:0), { mode:'cors' }); }
  catch(e){ alert('LED å¤±æ•—ï¼š' + e.message); }
}
</script>

</body>
</html>
